-- ====================================================================
-- ETZO STORE - HEADLESS AUTO FISH V1.2 (INSTANT UI & FAILSAFE)
-- ====================================================================
local WEBHOOK_URL = "PASTE_URL_WEBHOOK_DISCORD_DISINI"
local AUTO_SELL = true
local SELL_INTERVAL = 60
local DELAY_CHARGE = 1.30 
local DELAY_RESET = 0.35 

local TARGET_FISH = {
    ["Golden Megalodon"] = true,
    ["Abyssal Kraken"] = true,
    ["Void Leviathan"] = true,
}

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer

-- 1. MUNCULKAN UI INSTAN (Agar kita tahu script merespons)
local guiParent = game:GetService("CoreGui")
if not pcall(function() local _ = guiParent.Name end) then
    guiParent = LocalPlayer:WaitForChild("PlayerGui")
end

-- Hapus UI lama jika ada
if guiParent:FindFirstChild("EtzoBlackScreen") then
    guiParent.EtzoBlackScreen:Destroy()
end

local blackScreen = Instance.new("ScreenGui")
blackScreen.Name = "EtzoBlackScreen"
blackScreen.IgnoreGuiInset = true
blackScreen.ResetOnSpawn = false
blackScreen.Parent = guiParent

local frame = Instance.new("Frame")
frame.Size = UDim2.new(1, 0, 1, 0)
frame.BackgroundColor3 = Color3.new(0, 0, 0)
frame.Parent = blackScreen

local label = Instance.new("TextLabel")
label.Size = UDim2.new(1, 0, 1, 0)
label.BackgroundTransparency = 1
label.Text = "ETZO STORE - MEMUAT MESIN PANCING..."
label.TextColor3 = Color3.new(1, 1, 0) -- Warna Kuning (Loading)
label.Font = Enum.Font.Code
label.TextSize = 24
label.Parent = frame

print("[ETZO] UI Dimuat. Memulai injeksi jaringan...")

-- 2. EKSEKUSI LOGIKA JARINGAN DENGAN ERROR CATCHING
task.spawn(function()
    local success, errorMessage = pcall(function()
        local ReplicatedStorage = game:GetService("ReplicatedStorage")
        local RunService = game:GetService("RunService")
        local HttpService = game:GetService("HttpService")
        local VirtualUser = game:GetService("VirtualUser")

        -- üõ°Ô∏è GPU SAVER & ANTI-AFK
        LocalPlayer.Idled:Connect(function()
            VirtualUser:CaptureController()
            VirtualUser:ClickButton2(Vector2.new())
        end)

        settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
        game:GetService("Lighting").GlobalShadows = false
        RunService:Set3dRenderingEnabled(false)

        -- üîó MENGAMBIL REMOTE JARINGAN
        local net = ReplicatedStorage.Packages._Index["sleitnick_net@0.2.0"].net
        local ChargeRod    = net["RF/ChargeFishingRod"]
        local RequestGame  = net["RF/RequestFishingMinigameStarted"]
        local CompleteGame = net["RE/FishingCompleted"]
        local CancelInput  = net["RF/CancelFishingInputs"]
        local SellAll      = net["RF/SellAllItems"]
        local ObtainedNewFish = net["RE/ObtainedNewFishNotification"]

        -- üì° SISTEM WEBHOOK
        local HttpRequest = (syn and syn.request) or http_request or request or (fluxus and fluxus.request)
        local RARITY_MAP = {
            [1] = {Name = "Common", Color = 0x9e9e9e},
            [2] = {Name = "Uncommon", Color = 0x4caf50},
            [3] = {Name = "Rare", Color = 0x2196f3},
            [4] = {Name = "Epic", Color = 0x9c27b0},
            [5] = {Name = "Legendary", Color = 0xff9800},
            [6] = {Name = "Mythic", Color = 0xf44336},
            [7] = {Name = "Secret", Color = 0xff1744},
        }

        local function SendWebhook(fishName, tier, weight)
            if WEBHOOK_URL == "" or WEBHOOK_URL == "PASTE_URL_WEBHOOK_DISCORD_DISINI" then return end
            local rarityInfo = RARITY_MAP[tier] or {Name = "Unknown", Color = 0xffffff}
            local payload = {
                username = "Etzo Store Bot",
                embeds = {{
                    title = "üé£ Target Ikan Berhasil Ditangkap!",
                    color = rarityInfo.Color,
                    fields = {
                        { name = "Akun", value = LocalPlayer.Name, inline = true },
                        { name = "Ikan", value = fishName, inline = true },
                        { name = "Rarity", value = rarityInfo.Name, inline = true },
                        { name = "Berat", value = string.format("%.2f kg", weight or 0), inline = true },
                    },
                    timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
                }}
            }
            pcall(function()
                HttpRequest({
                    Url = WEBHOOK_URL,
                    Method = "POST",
                    Headers = { ["Content-Type"] = "application/json" },
                    Body = HttpService:JSONEncode(payload)
                })
            end)
        end

        local FishDB = {}
        for _, module in ipairs(ReplicatedStorage.Items:GetChildren()) do
            if module:IsA("ModuleScript") then
                local ok, mod = pcall(require, module)
                if ok and mod and mod.Data and mod.Data.Type == "Fish" then
                    FishDB[mod.Data.Id] = mod.Data
                end
            end
        end

        ObtainedNewFish.OnClientEvent:Connect(function(_, weightData, wrapper)
            if not wrapper or not wrapper.InventoryItem then return end
            local item = wrapper.InventoryItem
            if not item.Id then return end
            local fishData = FishDB[item.Id]
            if fishData and TARGET_FISH[fishData.Name] then
                SendWebhook(fishData.Name, fishData.Tier, weightData and weightData.Weight or 0)
            end
        end)

        -- üí∞ AUTO SELL
        local isFarming = true
        if AUTO_SELL then
            task.spawn(function()
                while isFarming do
                    task.wait(SELL_INTERVAL)
                    pcall(function() SellAll:InvokeServer() end)
                end
            end)
        end

        -- üé£ FISHING LOGIC
        local args = {-1.233, 1, workspace:GetServerTimeNow()}
        local function startFarming()
            pcall(function() CancelInput:InvokeServer() end)
            task.wait(0.1)
            
            while isFarming do
                task.spawn(function() pcall(function() ChargeRod:InvokeServer() end) end)
                task.wait(0.01)
                task.spawn(function() pcall(function() RequestGame:InvokeServer(unpack(args)) end) end)
                
                task.wait(DELAY_CHARGE)
                pcall(function() CompleteGame:FireServer() end)
                task.wait(0.01)
                pcall(function() CancelInput:FireServer() end)
                task.wait(DELAY_RESET)
            end
        end

        task.spawn(startFarming)
        
        -- UBAH UI JADI HIJAU (SUKSES)
        label.Text = "ETZO STORE - BOT AKTIF\n[ Mode Headless & Layar Dimatikan ]"
        label.TextColor3 = Color3.new(0, 1, 0)
        print("[ETZO] Mesin Pancing Berjalan!")
    end)

    if not success then
        -- UBAH UI JADI MERAH (ERROR)
        label.Text = "ETZO STORE - ERROR!\nSilakan Cek F9 (Console)\n" .. tostring(errorMessage)
        label.TextColor3 = Color3.new(1, 0, 0)
        warn("[ETZO ERROR FATAL] " .. tostring(errorMessage))
    end
end)
