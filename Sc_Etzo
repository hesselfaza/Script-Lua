-- ====================================================================
-- ETZO - HEADLESS AUTO FISH V3.0 (TALON BYPASS & LURAPH DECRYPT)
-- ====================================================================
local WEBHOOK_URL = "https://discord.com/api/webhooks/1462156419385004242/mvEgInDazIKpbd7nGaDt8nqqY_QaAe6eRhwiGEZScxDY499Urn4yKCtJstD35TSrdNur"
local AUTO_SELL = true
local SELL_INTERVAL = 30

-- üóø KONFIGURASI AUTO TOTEM
local AUTO_TOTEM = true
local TOTEM_INTERVAL = 180

-- üéØ TARGET IKAN (HURUF KECIL SEMUA)
local TARGET_FISH = {
    ["golden megalodon"] = true,
    ["sophisticated angler"] = true,
    ["abyssal kraken"] = true,
    ["void leviathan"] = true,
}

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer or Players:GetPropertyChangedSignal("LocalPlayer"):Wait()

-- 1. UI INSTAN (SMART DASHBOARD)
local guiParent = game:GetService("CoreGui")
if not pcall(function() local _ = guiParent.Name end) then
    guiParent = LocalPlayer:WaitForChild("PlayerGui")
end

if guiParent:FindFirstChild("EtzoBlackScreen") then
    guiParent.EtzoBlackScreen:Destroy()
end

local blackScreen = Instance.new("ScreenGui")
blackScreen.Name = "EtzoBlackScreen"
blackScreen.IgnoreGuiInset = true
blackScreen.ResetOnSpawn = false
blackScreen.Parent = guiParent

local frame = Instance.new("Frame")
frame.Size = UDim2.new(1, 0, 1, 0)
frame.BackgroundColor3 = Color3.new(0, 0, 0)
frame.Parent = blackScreen

local label = Instance.new("TextLabel")
label.Size = UDim2.new(1, 0, 1, 0)
label.BackgroundTransparency = 1
label.Text = "ETZO - MENEMBUS ENKRIPSI TALON..."
label.TextColor3 = Color3.new(1, 1, 0)
label.Font = Enum.Font.Code
label.TextSize = 24
label.Parent = frame

print("[ETZO] UI Dimuat. Memulai Bypass Jaringan...")

-- 2. EKSEKUSI JARINGAN (SAFE WAIT)
task.spawn(function()
    local success, errorMessage = pcall(function()
        local ReplicatedStorage = game:GetService("ReplicatedStorage")
        local RunService = game:GetService("RunService")
        local HttpService = game:GetService("HttpService")
        local VirtualUser = game:GetService("VirtualUser")

        -- üõ°Ô∏è GPU SAVER & ANTI-AFK
        LocalPlayer.Idled:Connect(function()
            VirtualUser:CaptureController()
            VirtualUser:ClickButton2(Vector2.new())
        end)

        settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
        game:GetService("Lighting").GlobalShadows = false
        RunService:Set3dRenderingEnabled(false)

        -- üîó DEKRIPSI JARINGAN (DYNAMIC RESOLVER)
        local Packages = ReplicatedStorage:WaitForChild("Packages", 30)
        local _Index = Packages:WaitForChild("_Index", 30)
        local sleitnick = _Index:WaitForChild("sleitnick_net@0.2.0", 30)
        local net = sleitnick:WaitForChild("net", 30)

        -- Menggunakan data dump Anda untuk memanggil remote yang tepat
        local EquipTool    = net:FindFirstChild("RE/}Fwmr+EF:{IIDuDMgh@") or net:WaitForChild("RE/EquipToolFromHotbar", 10)
        local ChargeRod    = net:FindFirstChild("RF/{=cvi<{@A>@H> D=") or net:WaitForChild("RF/ChargeFishingRod", 10)
        local RequestGame  = net:FindFirstChild("RF/+:sygJJ|7I?CE5\"Bsp5c?=)B7EM85") or net:WaitForChild("RF/RequestFishingMinigameStarted", 10)
        
        -- PERUBAHAN FATAL DARI TALON: FishingCompleted dihapus, diganti CatchFishCompleted
        local CompleteGame = net:FindFirstChild("RF/{6vgj|?J6xFGG::Mjk") or net:WaitForChild("RF/CatchFishCompleted", 10)
        
        local CancelInput  = net:FindFirstChild("RF/{6pggC{@A>@H>vCIz{A") or net:WaitForChild("RF/CancelFishingInputs", 10)
        local SellAll      = net:FindFirstChild("RF/,:npCCB B;DM") or net:WaitForChild("RF/SellAllItems", 10)
        local ObtainedNewFish = net:FindFirstChild("RE/(7vekE;;{;N @A='t{7h;;7B?BG") or net:WaitForChild("RE/ObtainedNewFishNotification", 10)
        local FavoriteItem = net:FindFirstChild("RE/~6xst@J<vJ<G") or net:WaitForChild("RE/FavoriteItem", 10)

        -- üì° SISTEM WEBHOOK & PENGHITUNG IKAN
        local totalCaught = 0
        local HttpRequest = (syn and syn.request) or http_request or request or (fluxus and fluxus.request)
        
        pcall(function()
            HttpRequest({
                Url = WEBHOOK_URL,
                Method = "POST",
                Headers = { ["Content-Type"] = "application/json" },
                Body = HttpService:JSONEncode({
                    username = "Etzo Store System",
                    content = "üü¢ **ETZO BOT V3 (BYPASSED) AKTIF!**\nAkun `" .. LocalPlayer.Name .. "` berhasil menembus enkripsi dan memancing."
                })
            })
        end)

        local RARITY_MAP = {
            [1] = {Name = "Common", Color = 0x9e9e9e}, [2] = {Name = "Uncommon", Color = 0x4caf50},
            [3] = {Name = "Rare", Color = 0x2196f3}, [4] = {Name = "Epic", Color = 0x9c27b0},
            [5] = {Name = "Legendary", Color = 0xff9800}, [6] = {Name = "Mythic", Color = 0xf44336},
            [7] = {Name = "Secret", Color = 0xff1744},
        }

        local function SendWebhook(fishName, tier, weight)
            if WEBHOOK_URL == "" then return end
            local rarityInfo = RARITY_MAP[tier] or {Name = "Unknown", Color = 0xffffff}
            local payload = {
                username = "Etzo Bot",
                embeds = {{
                    title = "üé£ Target Ikan Berhasil Ditangkap!", color = rarityInfo.Color,
                    fields = {
                        { name = "Akun", value = LocalPlayer.Name, inline = true },
                        { name = "Ikan", value = fishName, inline = true },
                        { name = "Rarity", value = rarityInfo.Name, inline = true },
                        { name = "Berat", value = string.format("%.2f kg", weight or 0), inline = true },
                    }, timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
                }}
            }
            pcall(function()
                HttpRequest({ Url = WEBHOOK_URL, Method = "POST", Headers = { ["Content-Type"] = "application/json" }, Body = HttpService:JSONEncode(payload) })
            end)
        end

        -- PERCOBAAN MENGAKSES DATABASE (Bisa gagal karena Luraph)
        local FishDB = {}
        pcall(function()
            for _, module in ipairs(ReplicatedStorage.Items:GetChildren()) do
                if module:IsA("ModuleScript") then
                    local ok, mod = pcall(require, module)
                    local data = (mod and type(mod) == "table" and mod.Data) or mod
                    if ok and data and data.Type == "Fish" then FishDB[data.Id] = data end
                end
            end
        end)

        -- ==========================================
        -- üõ°Ô∏è LURAPH BYPASS & AUTO FAVORITE
        -- ==========================================
        ObtainedNewFish.OnClientEvent:Connect(function(_, weightData, wrapper)
            if not wrapper or not wrapper.InventoryItem then return end
            
            totalCaught = totalCaught + 1
            local totemStatus = AUTO_TOTEM and "ON" or "OFF"
            label.Text = string.format("ETZO - BOT V3 AKTIF\n[ Mode: Legit Auto-Shake ]\n[ Auto Totem: %s ]\n\nüêü Total Ikan: %d", totemStatus, totalCaught)

            local item = wrapper.InventoryItem
            if not item.Id then return end
            
            -- ANTI-LURAPH: Jika db gagal dibaca, ambil ID asli ikan dari server lalu hilangkan garis bawahnya (_)
            local fishData = FishDB[item.Id]
            local rawName = fishData and fishData.Name or tostring(item.Id)
            local cleanName = string.lower(string.gsub(rawName, "_", " ")) -- "golden_megalodon" jadi "golden megalodon"
            
            local fTier = fishData and fishData.Tier or (weightData and weightData.Tier) or 1
            local fWeight = weightData and weightData.Weight or 0
            local isTarget = false
            
            -- PENGAMAN GEMSTONE RUBY
            if string.find(cleanName, "ruby") and string.find(cleanName, "gemstone") then
                isTarget = true
                pcall(function()
                    local uniqueId = wrapper.Id or item.InstanceId or item.UUID or item.Id
                    if FavoriteItem:IsA("RemoteEvent") then
                        FavoriteItem:FireServer(uniqueId, true)
                        FavoriteItem:FireServer(uniqueId)
                    else
                        FavoriteItem:InvokeServer(uniqueId, true)
                    end
                end)
                print("[ETZO] MENGAMANKAN MUTASI! Gemstone Ruby telah difavoritkan.")
            end
            
            for targetName, _ in pairs(TARGET_FISH) do
                if string.find(cleanName, targetName) then
                    isTarget = true
                    break
                end
            end
            
            if isTarget then SendWebhook(rawName, fTier, fWeight) end
        end)

        -- üí∞ AUTO SELL
        local isFarming = true
        if AUTO_SELL then
            task.spawn(function()
                while isFarming do
                    task.wait(SELL_INTERVAL)
                    pcall(function()
                        if SellAll:IsA("RemoteFunction") then SellAll:InvokeServer() else SellAll:FireServer() end
                    end)
                end
            end)
        end

        -- üé£ FISHING & BACKPACK SCANNER LOGIC
        local lastTotemPlace = 0

        local function startFarming()
            pcall(function() CancelInput:InvokeServer() end)
            task.wait(1)
            
            while isFarming do
                if AUTO_TOTEM and (os.time() - lastTotemPlace >= TOTEM_INTERVAL) then
                    local char = LocalPlayer.Character
                    local backpack = LocalPlayer:FindFirstChild("Backpack")
                    local humanoid = char and char:FindFirstChildOfClass("Humanoid")
                    
                    if char and backpack and humanoid then
                        local totemTool = nil
                        for _, invItem in ipairs(char:GetChildren()) do
                            if invItem:IsA("Tool") and string.find(string.lower(invItem.Name), "luck totem") then
                                totemTool = invItem; break
                            end
                        end
                        if not totemTool then
                            for _, invItem in ipairs(backpack:GetChildren()) do
                                if invItem:IsA("Tool") and string.find(string.lower(invItem.Name), "luck totem") then
                                    totemTool = invItem; break
                                end
                            end
                        end
                        if totemTool then
                            humanoid:EquipTool(totemTool)
                            task.wait(0.5)
                            VirtualUser:CaptureController(); VirtualUser:ClickButton1(Vector2.new(500, 500)); task.wait(1)
                            lastTotemPlace = os.time()
                        end
                    end
                end

                local currentArgs = {-1.233, 1, workspace:GetServerTimeNow()}
                pcall(function()
                    if EquipTool:IsA("RemoteEvent") then EquipTool:FireServer(1) else EquipTool:InvokeServer(1) end
                end) 
                task.wait(0.2)
                
                task.spawn(function() pcall(function() if ChargeRod:IsA("RemoteFunction") then ChargeRod:InvokeServer() else ChargeRod:FireServer() end end) end)
                task.wait(0.1)
                task.spawn(function() pcall(function() if RequestGame:IsA("RemoteFunction") then RequestGame:InvokeServer(unpack(currentArgs)) else RequestGame:FireServer(unpack(currentArgs)) end end) end)
                
                task.wait(1.5)
                for i = 1, 20 do
                    if not isFarming then break end
                    pcall(function() 
                        -- BYPASS: Karena CompleteGame sekarang jadi RemoteFunction
                        if CompleteGame:IsA("RemoteFunction") then
                            CompleteGame:InvokeServer()
                        else
                            CompleteGame:FireServer()
                        end
                    end)
                    task.wait(0.1)
                end
                
                pcall(function() if CancelInput:IsA("RemoteFunction") then CancelInput:InvokeServer() else CancelInput:FireServer() end end)
                task.wait(0.8)
            end
        end

        task.spawn(startFarming)
        label.Text = string.format("ETZO - BOT V3 AKTIF\n[ Mode: Legit Auto-Shake ]\n[ Auto Totem: %s ]\n\nüêü Total Ikan Ditangkap: 0", AUTO_TOTEM and "ON" or "OFF")
        label.TextColor3 = Color3.new(0, 1, 0)
    end)

    if not success then
        label.Text = "ETZO V3 - ERROR!\n" .. tostring(errorMessage)
        label.TextColor3 = Color3.new(1, 0, 0)
    end
end)
