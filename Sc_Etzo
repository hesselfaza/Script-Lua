-- ====================================================================
-- ETZO - HEADLESS AUTO FISH V6.0 (PRECISE FAST REEL & OWNERSHIP FILTER)
-- ====================================================================
local WEBHOOK_URL = "https://discord.com/api/webhooks/1462156419385004242/mvEgInDazIKpbd7nGaDt8nqqY_QaAe6eRhwiGEZScxDY499Urn4yKCtJstD35TSrdNur"
local AUTO_SELL = true
local SELL_INTERVAL = 30
local AUTO_TOTEM = true
local TOTEM_INTERVAL = 180

-- üéØ TARGET IKAN
local TARGET_FISH = {
    ["golden megalodon"] = true,
    ["sophisticated angler"] = true,
    ["abyssal kraken"] = true,
    ["void leviathan"] = true,
}

local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer or Players:GetPropertyChangedSignal("LocalPlayer"):Wait()
local HttpService = game:GetService("HttpService")

local guiParent = game:GetService("CoreGui")
if not pcall(function() local _ = guiParent.Name end) then guiParent = LocalPlayer:WaitForChild("PlayerGui") end
if guiParent:FindFirstChild("EtzoBlackScreen") then guiParent.EtzoBlackScreen:Destroy() end

local blackScreen = Instance.new("ScreenGui")
blackScreen.Name = "EtzoBlackScreen"
blackScreen.IgnoreGuiInset = true
blackScreen.ResetOnSpawn = false
blackScreen.Parent = guiParent

local frame = Instance.new("Frame")
frame.Size = UDim2.new(1, 0, 1, 0)
frame.BackgroundColor3 = Color3.new(0, 0, 0)
frame.Parent = blackScreen

local label = Instance.new("TextLabel")
label.Size = UDim2.new(1, 0, 1, 0)
label.BackgroundTransparency = 1
label.Text = "ETZO - MEMUAT V6.0 PRECISE STRIKE..."
label.TextColor3 = Color3.new(1, 1, 0)
label.Font = Enum.Font.Code
label.TextSize = 24
label.Parent = frame

task.spawn(function()
    local success, errorMessage = pcall(function()
        local ReplicatedStorage = game:GetService("ReplicatedStorage")
        local RunService = game:GetService("RunService")
        local VirtualUser = game:GetService("VirtualUser")

        LocalPlayer.Idled:Connect(function() VirtualUser:CaptureController(); VirtualUser:ClickButton2(Vector2.new()) end)
        settings().Rendering.QualityLevel = Enum.QualityLevel.Level01
        game:GetService("Lighting").GlobalShadows = false
        RunService:Set3dRenderingEnabled(false)

        local Packages = ReplicatedStorage:WaitForChild("Packages", 30)
        local _Index = Packages:WaitForChild("_Index", 30)
        local sleitnick = _Index:WaitForChild("sleitnick_net@0.2.0", 30)
        local net = sleitnick:WaitForChild("net", 30)

        local totalCaught = 0
        local HttpRequest = (syn and syn.request) or http_request or request or (fluxus and fluxus.request)
        
        pcall(function()
            HttpRequest({
                Url = WEBHOOK_URL, Method = "POST", Headers = { ["Content-Type"] = "application/json" },
                Body = HttpService:JSONEncode({ username = "Etzo System", content = "üü¢ **ETZO V6.0 AKTIF!**\nSistem Anti-Tertukar & Precise Fast Reel siap untuk `" .. LocalPlayer.Name .. "`." })
            })
        end)

        local function SendWebhook(fishName)
            if WEBHOOK_URL == "" then return end
            local payload = {
                username = "Etzo Bot",
                embeds = {{
                    title = "üé£ Target Ikan Berhasil Ditangkap!", color = 0xff9800,
                    fields = {
                        { name = "Akun", value = LocalPlayer.Name, inline = true },
                        { name = "Ikan", value = fishName, inline = true },
                    }, timestamp = os.date("!%Y-%m-%dT%H:%M:%SZ")
                }}
            }
            pcall(function() HttpRequest({ Url = WEBHOOK_URL, Method = "POST", Headers = { ["Content-Type"] = "application/json" }, Body = HttpService:JSONEncode(payload) }) end)
        end

        -- ==========================================
        -- ‚ò¢Ô∏è X-RAY + OWNERSHIP FILTER (ANTI-TERTUKAR)
        -- ==========================================
        local function xRayScan(data, checked)
            checked = checked or {}
            if type(data) ~= "table" then return nil end
            if checked[data] then return nil end
            checked[data] = true
            
            for k, v in pairs(data) do
                if type(v) == "string" then
                    local cleanStr = string.lower(string.gsub(v, "_", " "))
                    if string.find(cleanStr, "megalodon") or string.find(cleanStr, "kraken") or string.find(cleanStr, "leviathan") or string.find(cleanStr, "angler") or string.find(cleanStr, "ruby") then
                        return v
                    end
                elseif type(v) == "table" then
                    local res = xRayScan(v, checked)
                    if res then return res end
                end
            end
            return nil
        end

        local function isFishOwnedByOtherPlayer(args)
            local success, jsonStr = pcall(function() return HttpService:JSONEncode(args) end)
            if not success then return false end
            
            for _, player in ipairs(Players:GetPlayers()) do
                -- Jika ada nama player lain di dalam data ikan tersebut, berarti itu bukan milik kita!
                if player ~= LocalPlayer then
                    if string.find(jsonStr, player.Name) or string.find(jsonStr, player.DisplayName) then
                        return true
                    end
                end
            end
            return false
        end

        local processedFish = {}
        
        -- ==========================================
        -- ‚ö° PRECISE FAST REEL (ANTI-STUCK)
        -- ==========================================
        local isReeling = false
        local function triggerFastReel()
            if isReeling then return end
            isReeling = true
            task.spawn(function()
                task.wait(0.3) -- Jeda emas 300ms agar server game siap menerima sinyal penarikan
                local catchEnc = net:FindFirstChild("RF/{6vgj|?J6xFGG::Mjk")
                local catchPlain = net:FindFirstChild("RF/CatchFishCompleted")
                
                -- Tembakan presisi (Single-Shot), tidak ada lagi spam 15x
                pcall(function() if catchEnc then catchEnc:InvokeServer() end end)
                pcall(function() if catchPlain then catchPlain:InvokeServer() end end)
                
                task.wait(1.5) -- Waktu pendinginan sebelum bisa Fast Reel lagi
                isReeling = false
            end)
        end

        for _, remote in ipairs(net:GetChildren()) do
            if remote:IsA("RemoteEvent") then
                -- 1. PEMICU FAST REEL
                if string.find(string.lower(remote.Name), "minigame") or string.find(remote.Name, "~>ulk") then
                    remote.OnClientEvent:Connect(triggerFastReel)
                end
                
                -- 2. PENYADAP IKAN
                remote.OnClientEvent:Connect(function(...)
                    local args = {...}
                    
                    -- BLOKIR JIKA IKAN MILIK ORANG LAIN
                    if isFishOwnedByOtherPlayer(args) then return end
                    
                    local rawFishData = nil
                    for _, arg in pairs(args) do
                        if type(arg) == "table" then
                            rawFishData = xRayScan(arg)
                        elseif type(arg) == "string" then
                            local cStr = string.lower(string.gsub(arg, "_", " "))
                            if string.find(cStr, "megalodon") or string.find(cStr, "kraken") or string.find(cStr, "ruby") or string.find(cStr, "leviathan") or string.find(cStr, "angler") then
                                rawFishData = arg
                            end
                        end
                        if rawFishData then break end
                    end
                    
                    if rawFishData then
                        if processedFish[rawFishData] and (os.time() - processedFish[rawFishData] < 3) then return end
                        processedFish[rawFishData] = os.time()
                        
                        totalCaught = totalCaught + 1
                        label.Text = string.format("ETZO - BOT V6.0 AKTIF\n[ Mode: Auto-Bawaan + Fast Reel ]\n[ X-Ray Scanner: ON ]\n\nüêü Ikan Langka: %d\nüé£ Terakhir: %s", totalCaught, tostring(rawFishData))

                        local cleanName = string.lower(string.gsub(rawFishData, "_", " "))
                        local isTarget = false
                        
                        if string.find(cleanName, "ruby") and string.find(cleanName, "gemstone") then
                            isTarget = true
                            for _, r in ipairs(net:GetChildren()) do
                                if string.find(string.lower(r.Name), "favorite") or string.find(r.Name, "~6xs") then
                                    task.spawn(function() pcall(function() if r:IsA("RemoteFunction") then r:InvokeServer(rawFishData, true) elseif r:IsA("RemoteEvent") then r:FireServer(rawFishData, true) end end) end)
                                end
                            end
                            print("[ETZO] MENGAMANKAN MUTASI! Gemstone Ruby telah difavoritkan.")
                        end
                        
                        for targetName, _ in pairs(TARGET_FISH) do
                            if string.find(cleanName, targetName) then isTarget = true; break end
                        end
                        
                        if isTarget then SendWebhook(rawFishData) end
                    end
                end)
            end
        end

        local isFarming = true

        -- üí∞ AUTO SELL
        if AUTO_SELL then
            task.spawn(function()
                while isFarming do
                    task.wait(SELL_INTERVAL)
                    local sellRemote = nil
                    for _, r in ipairs(net:GetChildren()) do
                        if r:IsA("RemoteFunction") and (string.find(string.lower(r.Name), "sellall") or (string.find(r.Name, ",:np") and string.len(r.Name) > 12)) then
                            sellRemote = r; break
                        end
                    end
                    if sellRemote then pcall(function() sellRemote:InvokeServer() end) end
                end
            end)
        end

        -- üóø AUTO TOTEM
        local lastTotemPlace = 0
        task.spawn(function()
            while isFarming do
                task.wait(1)
                if AUTO_TOTEM and (os.time() - lastTotemPlace >= TOTEM_INTERVAL) then
                    local char = LocalPlayer.Character
                    local backpack = LocalPlayer:FindFirstChild("Backpack")
                    local hum = char and char:FindFirstChildOfClass("Humanoid")
                    
                    if char and backpack and hum then
                        local totemTool = nil
                        for _, invItem in ipairs(char:GetChildren()) do
                            if invItem:IsA("Tool") and string.find(string.lower(invItem.Name), "luck totem") then totemTool = invItem; break end
                        end
                        if not totemTool then
                            for _, invItem in ipairs(backpack:GetChildren()) do
                                if invItem:IsA("Tool") and string.find(string.lower(invItem.Name), "luck totem") then totemTool = invItem; break end
                            end
                        end
                        
                        if totemTool then
                            hum:EquipTool(totemTool)
                            task.wait(0.5)
                            VirtualUser:CaptureController(); VirtualUser:ClickButton1(Vector2.new(500, 500)); task.wait(1)
                            for _, r in ipairs(net:GetChildren()) do
                                if r:IsA("RemoteEvent") and (string.find(string.lower(r.Name), "equiptool") or string.find(r.Name, "}Fwmr")) then
                                    pcall(function() r:FireServer(1) end); break
                                end
                            end
                            lastTotemPlace = os.time()
                        end
                    end
                end
            end
        end)
        
        label.Text = "ETZO - BOT V6.0 AKTIF\n[ Mode: Auto-Bawaan + Fast Reel ]\n[ X-Ray Scanner: ON ]\n\nüêü Ikan Langka: 0\nüé£ Terakhir: Menunggu tangkapan..."
    end)
    if not success then label.Text = "ETZO V6.0 - ERROR!\n" .. tostring(errorMessage); label.TextColor3 = Color3.new(1, 0, 0) end
end)
